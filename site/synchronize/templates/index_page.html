<!DOCTYPE html>
{% extends "base/base.html" %}
{% load static %}
{% block main %}
<link rel="stylesheet" href="{% static "css/index_page.css" %}">

<div class="base">
  <div class="px-4 py-5 my-5 text-center">
    <h1 class="title display-5 fw-bold">Synchronize</h1>
    <p>Сервис для шифрования и расшифровки файлов. Локально, прямо в вашем браузере</p>
  </div>
  <p>Выберите файл для локальной обработки:</p>

  <form id="local-form">
    {% csrf_token %}
    <div class="mb-3">
      <label for="encryption-key" class="form-label">Ключ шифрования/расшифровки</label>
      <input type="password" class="form-control" id="encryption-key" name="key" required minlength="8">
      <div class="text_container">
        Минимум 8 символов. Для расшифровки используйте тот же ключ, что и при шифровании.
      </div>
    </div>
    
    <div class="mb-3">
      <div class="form-check form-check-inline">
        <input class="form-check-input" type="radio" name="mode" id="mode-encrypt" value="encrypt" checked>
        <label class="form-check-label" for="mode-encrypt">Зашифровать</label>
      </div>
      <div class="form-check form-check-inline">
        <input class="form-check-input" type="radio" name="mode" id="mode-decrypt" value="decrypt">
        <label class="form-check-label" for="mode-decrypt">Расшифровать</label>
      </div>
      <div class="text_container">
        Файлы для расшифровки должны иметь расширение <code>.enc</code>
      </div>
    </div>

    <div class="mb-3">
      <input class="form-control" type="file" id="local-file" name="file" required>
    </div>
    
    <div class="d-flex flex-wrap gap-2 mb-3">
      <button type="submit" class="btn btn-primary">Обработать локально</button>
      <button type="button" class="btn btn-success" id="download-btn" style="display:none;">Скачать результат</button>
      <button type="button" class="btn btn-info" id="send-btn" style="display:none;">Отправить на сервер</button>
    </div>
  </form>

  <div id="status" class="mt-3 alert alert-secondary" role="alert">Готов к работе</div>
  <pre id="output" class="mt-3 bg-light p-3 rounded" style="white-space:pre-wrap; max-height:300px; overflow:auto;"></pre>
</div>

<script>
  window.ENCRYPT_PY_URL = '{% static "scripts/encrypt.py" %}';
</script>
<script src="https://cdn.jsdelivr.net/pyodide/v0.23.4/full/pyodide.js"></script>
<script src="{% static 'scripts/index_page_script.js' %}"></script>
{% endblock main %}